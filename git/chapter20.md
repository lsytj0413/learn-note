# 第二十章: 提示, 技巧和技术 #

## 对脏的工作目录进行交互式变基 ##

在工作目录是脏的情况下, 如果使用 git rebase -i 命令 Git 会拒绝进行变基. 这时可以使用 git stash 清理脏的工作目录:

```
$ git stash
$ git rebase -i master~4
$ git stash pop
```

## 删除剩余的编辑器文件 ##

假设你在版本库中无意添加了编辑器的临时文件, 可以使用如下命令解决:

```
$ git filter-branch --tree-filter 'rm -f *~' -- --all
```

## 垃圾回收 ##

Git 会使用垃圾回收(garbage collection)算法来清理未引用的对象, 可以使用 git gc 命令来触发垃圾回收, 该命令有两个作用:

1. 保持版本库对象库的整洁
2. 通过定位未压缩的对象并生成打包文件, 从而优化版本库的大小

Git 会在以下几种情况下自动进行垃圾回收:

1. 版本库里有过多的松散对象
2. 当推送到一个远程版本库时
3. 在一些命令引入许多松散对象之后
4. 但一些命令(如 git reflog expire) 明确要求时

可以在以下几种情况下手动运行 git gc:

1. 刚刚完成一个 git filter-branch
2. 在一些命令引入许多松散对象之后, 例如大量变基操作

在以下情况应该警惕垃圾回收:

1. 有想要恢复的孤立文件
2. 在 git rerere 的情况下, 而你又不必永久保存该解决方案
3. 在只有标签和分支就足以让 Git 永久保留提交的情况下
4. 在获取 FETCH_HEAD 的情况下, 因为它们即会进行垃圾回收

对于垃圾回收, 有以下几个比较重要的 git config 参数:

1. gc.auto: 在被垃圾回收打包之前, 版本库中允许存在的松散对象的数量, 默认值为 6700
2. gc.autopacklimit: 版本库内运行存在的打包文件的数量, 默认值为 50
3. gc.pruneexpire: 不可达对象在对象库里的持续时间, 默认值为两周
4. gc.reflogexpire: git reflog expire 命令会删除比这个时间旧的 reflog 条目, 默认值为 90 天
5. gc.reflogexpireunreachable: 仅当 reflog 条目在当前分支不可达时, 大于一定时间限制的条目才会被 git reflog expire 命令删除, 这个时间限制的默认值是 30 天

大部分垃圾回收配置参数都具有表示现在就做或永远不做的值.

## 拆分版本库 ##

## 恢复提交的小贴士 ##

## 转换 Subversion 的技巧 ##

### 普适建议 ###

### 删除 SVN 导入后的 trunk ###

### 删除 SVN 提交 ID ###

## 操作来自两个版本库的分支 ##

## 从上游变基中恢复 ##

## 定制 Git 命令 ##

## 快速查看变更 ##

## 清理 ##

## 使用 git-grep 来搜索版本库 ##

## 更新和删除 ref ##

## 跟踪移动的文件 ##

## 保留但不追踪文件 ##

## 你来过这里吗 ##
