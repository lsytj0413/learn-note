# 第二十一章: 格式化输出 #

本章介绍的命令如下:

- nl: 对行进行标号
- fold: 设定文本行长度
- fmt: 简单的文本格式化工具
- pr: 格式化打印文本
- printf: 格式化并打印数据
- grof: 文档格式化系统

## 21.1 简单的格式化工具 ##

### 21.1.1 nl-对行进行标号 ###

nl命令用于对行进行编号, 类似于 cat -n.

nl进行编号时支持一个叫做逻辑页的概念, 它可以重置数值序列. 逻辑页可以进一步分解为逻辑页标题, 正文和页脚. 如果nl的输入参数是多个文件, 那么nl会把它们当作一个文本流整体. 文本流中的每一个部分都由一些标记来区别, 如下表:

| 标记 | 含义 |
|:--|:--|
| \:\:\: | 逻辑页页眉开头 |
| \:\: | 逻辑页正文开头 |
| \: | 逻辑页页脚开头 |

每一个标记元素在一行中只允许出现一次, 每次处理完一个标记元素后, nl便将其从文本流中删除.

nl常用的选项如下表:

| 选项 | 含义 |
|:--|:--|
| -b style | 按照style格式对正文进行编号 |
| -f style | 按照style格式对页脚进行编号, 默认是不进行编号 |
| -h style | 按照style格式对标题进行编号, 默认是不进行编号 |
| -i number | 设置页编号的步进值为number, 默认值是1 |
| -n format | 设置编号格式 |
| -p | 在每个逻辑页的开始不再进行页编码重置 |
| -s string | 在每行行号后面增加string作为分隔符, 默认情况为一个tab制表符 |
| -v number | 设置每个逻辑页的第一个行号, 默认值是1 |
| -w width | 设置行号字段的宽度为width, 默认为6 |

编号style可用值如下表:

| style | 含义 |
|:--|:--|
| a | 对每行编号 |
| t | 仅仅对非空白行编号, 对正文是默认选项 |
| n | 不对任何行进行编号 |
| pregexp | 只对与基本正则表达式匹配的行进行编号 |

编号格式可用值如下表:

| 编号格式 | 含义 |
|:--|:--|
| ln | 左对齐, 无缩进 |
| rn | 右对齐, 无缩进, 默认选项 |
| rz | 右对齐, 有缩进 |

用户可以利用nl结合其他工具进行更复杂的任务, 首先利用文本编辑器编辑sed脚本, 并保存为 distros-nl.sed, 内容如下:

```
# sed script to produce Linux distributions report

1 i\
\\:\\:\\:
\
Linux Distributions Report\
\
Name         Ver.           Released\
----         ----           --------\
\\:\\:
s/\([0-9]\{2\}\)\/\([0-9]\{2\}\)\/\([0-9]\{4\}\)$/\3-\1-\2-/
$ a\
\\:\
\
End Of Report
```

该脚本文件完成了向原报告中插入nl逻辑页标记以及在报告末尾添加页脚内容的任务, 输入标记时需要使用双斜杠以避免sed将它们解释为转义字符.

然后结合sort, sed和nl创建一个报告文本:

```
sort -k 1,1 -k 2n distros.txt | sed -f distros-nl.sed | nl
```

### 21.1.2 fold-将文本中的行长度设定为指定长度 ###

fold是一个将文本行以指定长度分解的操作, 支持将一个或多个文本文件或是标准输入作为输入参数.

```
echo "The quick brown fox jumped over the lazy dog." | fold -w 12
```

在使用fold时如果没有指定宽度参数, 则默认为80, 而且fold在断行时并不会考虑单词边界, 可以添加 -s 选项使fold在到达width字符数前的最后一个有效空格处将原文本行断开.

### 21.1.3 fmt-简单的文本格式化工具 ###

fmt命令同样会折叠文本, 它即可以处理文件也可以处理标准输入, 并对文本流进行段落格式化, 它可以在保留空白行和缩进的同时对文本进行填充和连接.

```
fmt -w 50 fmt-info.txt | head
```

在fmt命令中, 默认情况下, 空白行, 单词之间的空格和缩进都保留在输出结果中; 不同缩进量的连续输入行并不进行拼接; 制表符会在输入中扩展并直接输出.

fmt命令常用的选项如下表:

| 选项 | 功能描述 |
|:--|:--|
| -c | 保留段落前两行的缩进, 随后的行都与第二行的缩进对齐 |
| -p string | 只格式化以前缀字符串string开头的行, 格式化后string的内容会作为每一个格式化行的前缀 |
| -s | 仅截断行模式, 在此模式下将会只根据指定的列宽截断行, 而短行不会与其他行结合 |
| -u | 字符间隔统一, 字符之间间隔一个空格字符, 句子之间间隔两个空格字符 |
| -w width | 默认值为75 |

通过 -p 选项, 我们可以选择性的格式化文件内容, 前提是要格式化的文本行都以相同的字符序列开头.

```
cat > fmt-code.txt
# This file contains code with comments.

# This line is a comment.
# Followed by another comment line.
# ANd another.

This, on the other hand, is a line of code.
And another line of code.
ANd another.

fmt -w 50 -p '# ' fmt-code.txt
```

### 21.1.4 pr-格式化打印文本 ###

### 21.1.5 printf-格式化并打印数据 ###

## 21.2 文档格式化系统 ##

### 21.2.1 roff和TEX家族 ###

### 21.2.2 groff-文档格式化系统 ###

### 21.3 本章结尾语 ###
