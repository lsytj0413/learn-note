# 第十七章: 文件搜索 #

本章介绍的命令如下:

- locate: 通过文件名查找文件
- find: 在文件系统目录框架中查找文件
- xargs: 从标准输入中建立, 执行命令行
- touch: 更改文件的日期时间
- stat: 显示文件或文件系统的状态

## 17.1 locate-较简单的方式查找文件 ##

locate命令通过快速搜索数据库, 以寻找路径名与给定字符串相匹配的文件, 同时输出所有匹配结果.

```
# 查找bin目录下的zip开头的文件
locate bin/zip
# 更复杂的搜索
locate zip | grep bin
```
locate命令有很多衍生版本, 其中slocate与mlocate是比较常用的, 它们通常由名为locate的符号链接访问.

locate搜索的数据库来自与另一个叫做updatedb的命令创建的, 通常该命令由cron任务定期执行, 多数系统每天执行一次, 所以locate可能会出现不能搜索到较新的文件的情况.
如果想要对较新的文件生效, 可以手动运行updatedb命令.

## 17.2 find-较复杂的方式查找文件 ##

find命令可以根据文件的各种属性在既定的目录及其子目录中查找.

```
# 列出家目录下的文件列表
find ~
# 统计文件数量
find ~ | wc -l
```
find命令可以用来搜索符合特定要求的文件, 通过综合应用test选项, action选项以及options选项来实现高级文件搜索.

### 17.2.1 test选项 ###

可以使用以下test选项来查找目录或普通文件:

```
# 目录
find ~ -type d | wc -l
# 普通文件
find ~ -type f | wc -l
```

常用的文件类型如下表:

| 文件类型 | 描述 |
|:--|:--|
| b | 块设备文件 |
| c | 字符设备文件 |
| d | 目录 |
| f | 普通文件 |
| l | 符号链接 |

还可以添加其他选项实现依据文件大小和文件名的搜索:

```
find ~ -type f -name "*.JPG" -size +1M | wc -l
```
使用-name选项表示查找文件的通配符格式, 此处使用双引号来避免shell的路径名扩展. 使用-size选项来表示文件大小的匹配, 加号表示比给定数值大, 减号表示比给定数值小, 没有符号则表示完全相等.

find支持的计量单位如下表:

| 字母 | 单位 |
|:--|:--|
| b | 512字节的块(默认值) |
| c | 字节 |
| w | 两个字节的字 |
| k | KB |
| M | MB |
| G | GB |

find命令支持的test选项参数如下表(加号和减号的规则适用于所有用到数值参数的情况):

| test参数 | 描述 |
|:--|:--|
| -cmin n | 匹配n分钟前改变状态(内容或属性)的文件或目录, -n表示不到n分钟, +n表示超过n分钟 |
| -cnewer file | 内容或属性修改时间比文件file更晚的文件或目录 |
| -ctime n | 匹配系统中n*24小时前文件状态(内容, 属性或访问权限)被改变的文件或目录 |
| -empty | 空文件或空目录 |
| -group name | 匹配属于name组的文件或目录, name可以是名称或组ID号 |
| -iname pattern | 与-name选项类似, 不区分大小写 |
| -inum n | 匹配索引节点是n的文件, 用于查找某个特定索引节点的所有硬件链接 |
| -mmin n | 匹配n分钟前改变内容的文件或目录 |
| -mtime n | 匹配24*n小时前只有内容被改变的文件或目录 |
| -name pattern | 匹配特定通配符模式的文件或目录 |
| -newer file | 内容修改时间比file更近的文件或目录, 文件备份时非常有用, 每次备份时更新某个文件(如日志), 然后用此参数确定上一次更新后哪个文件被改变 |
| -nouser | 匹配不属于有效用户的文件或目录, 可用来查找属于已删除账户的文件, 也可以用来检测攻击者的活动 |
| -nogroup | 匹配不属于有效组的文件或目录 |
| -perm mode | 寻找访问权限与既定模式匹配的文件或目录, 既定模式可以以八进制或符号的形式表示 |
| -samefile name | 与-inum 类似, 匹配与file文件用相同的inode号的文件 |
| -size n | 匹配n大小的文件 |
| -type c | 匹配c类型的文件 |
| -user name | 属于name用户的文件或目录, name可以是用户名或用户ID号 |

### 17.2.2 action选项 ###

### 17.2.3 返回到playground文件夹 ###

### 17.2.4 option选项 ###
