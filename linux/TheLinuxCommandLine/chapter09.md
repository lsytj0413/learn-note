# 第九章: 权限 #

本章介绍的命令如下:

- id: 显示用户身份标识
- chmod: 更改文件的模式
- umask: 设置文件的默认权限
- su: 以另一个用户的身份运行shell
- sudo: 以另一个用户的身份来执行命令
- chown: 更改文件所有者
- chgrp: 更改文件所属群组
- passwd: 更改用户密码

## 9.1 所有者, 组成员和其他所有用户 ##

在UNIX安全模型中, 一个用户可以拥有文件和目录. 当一个用户拥有一个文件或目录时, 它将对该文件或目录的访问权限拥有控制权. 用户又属于一个群组, 该群组由一个或多个用户组成, 组中用户对文件和目录的访问权限由其所有者赋予. 除了可以授予群组访问权限之外, 文件所有者也可以授予所有用户一些访问权限.

使用id命令可以获得用户身份标识的相关信息:

```
id
uid=1000(soren) gid=1000(soren) 组=1000(soren),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)
```

在创建用户的时候, 用户将被分配一个用户ID, 用户ID与用户名一一映射. 同时用户将被分配一个有效组ID, 而且该用户也可以归属于其他的群组.

在Fedora系统中, 普通用户帐号是从500开始编号的, 在Ubuntu系统中是从1000开始的.

用户帐号定义在 /etc/passwd文件中, 用户组定义在 /etc/group文件中, 文件 /etc/shadow 中保存了用户的密码信息. 对于每一个用户账户, 文件 /etc/passwd 中都定义了对应用户的用户名, uid, gid, 账户的真实姓名, 主目录以及登录shell信息.

## 9.2 读取, 写入和执行 ##

对文件和目录的访问权限是按照读访问, 写访问以及执行访问来定义的.

常见的文件类型如下表:

| 属性 | 文件类型 |
|:--|:--|
| - | 普通文件 |
| d | 目录文件 |
| l | 符号链接, 文件属性始终为rwxrwxrwx, 这是个伪属性值, 指向的文件属性才是真的文件属性 |
| c | 字符设备文件, 表示以字节流形式处理数据的设备, 如终端 |
| b | 块设备文件, 表示以数据块方式处理数据的设备, 如光盘驱动 |

文件属性中剩下的9个字符称为文件模式, 分别表示文件所有者, 文件所属群组和其他用户对该文件的读取, 写入和执行权限.

权限属性如下表:

| 属性 | 文件 | 目录 |
|:--|:--|:--|
| r | 允许打开和读取 | 如果设置了执行权限, 则运行列出目录下的内容 |
| w | 允许写入或截断文件, 如果也设置了执行权限, 那么目录中的文件允许创建, 被删除以及被重命名 | 不允许重命名或删除文件, 该功能由目录权限决定 |
| x | 允许把文件当作程序一样来执行, 以脚本编写的文件必须被设置为可读 | 允许进入目录下 |

### 9.2.1 chmod-更改文件模式 ###

文件所有者和超级用户可以使用chmod命令修改文件的模式. chmod支持两种不同的改变文件模式的方法, 一是八进制数字表示法, 二是符号表示法.

1. 八进制数字表示法

八进制表示法指的是使用八进制数字来设置所期望的权限模式. 表示法如下表:

| 八进制 | 二进制 | 文件模式 |
|:--|:--|:--|
| 0 | 000 | --- |
| 1 | 001 | --x |
| 2 | 010 | -w- |
| 3 | 011 | -wx |
| 4 | 100 | r-- |
| 5 | 101 | r-x |
| 6 | 110 | rw- |
| 7 | 111 | rwx |

例如:

```
chmod 600 foo.txt
```

2. 符号表示法

chmod命令支持一种符号表示法来指定文件模式, 该符号表示法分为三个部分: 更改会影响谁, 要执行哪个操作以及要设置哪种权限.

对象表:

| 符号 | 含义 |
|:--|:--|
| u | user的简写, 表示文件或者目录的所有者 |
| g | 文件所属群组 |
| o | others的简写, 表示其他所有用户 |
| a | all的简写, 默认值 |

操作符 [+] 表示添加权限, [-] 表示删除权限, [=] 表示只有指定权限可用, 其他的权限都被删除. 权限由字符 [r], [w], [x] 指定.

### 9.2.2 采用GUI设置文件模式 ###

通过GUI的对话框也可以设置文件模式.

### 9.2.3 umask-设置默认权限 ###

umask命令设置创建文件时指定给文件的默认权限, 它使用八进制表示法表示从文件模式属性中删除一个位掩码.

```
# 查看当前位掩码
umask
```

除了常见的读写执行权限之外, 还有几个少用的权限设置.

1. setuid

八进制为 (4000), 当把它应用到一个可执行文件时, 有效用户id将从实际用户id设置成程序所有者的id.

2. setgid

八进制为 (2000), 把有效组id从用户的实际组id更改为文件所有者的组id. 如果对一个目录设置setgid位, 那么该目录下新创建的文件将由该目录所在组所有, 而不是文件创建者所在组所有. 当一个公共组下的成员需要访问共享目录下的所有文件时特别有效.

3. sticky

八进制为 (1000), 表示一个可执行文件是不可变换的. 在linux下会忽略文件的sticky位, 但是如果对一个目录设置sticky位, 那么将阻止用户删除或重命名文件, 除非用户是这个目录的所有者, 文件所有者或者是超级用户.

```
# setuid
chmod u+s file
# setgid
chmod g+s file
# sticky
chmod +t dir
```

## 9.3 更改身份 ##

### 9.3.1 su-以其他用户的组ID的身份来运行shell ###

### 9.3.2 sudo-以另一个用户的身份执行命令 ###

### 9.3.3 chown-更改文件所有者和所属群组 ###

### 9.3.4 chgrp-更改文件所属群组 ###

## 9.4 权限的使用 ##

## 9.5 更改用户密码 ##
