# 第三十章: 故障诊断 #

本章讲解一些脚本中常见的错误类型以及几种用于追踪和解除错误的有用技巧.

## 30.1 语法错误 ##

语法错误是一种常见的错误类型, 其中就包括shell语句中一些元素的拼写错误. 在大多数情况下shell会拒绝执行含有此种类型错误的脚本.

我们将使用以下脚本来演示常见的错误类型:

```
#!/bin/bash

# trouble: script to demonstrate common errors

number=1

if [ $number = 1 ]; then
    echo "Number is euqal to 1."
else
    echo "Number is not euqal to 1."
fi
```

### 30.1.1 引号缺失 ###

修改上述脚本, 删除第一个echo命令实参后的双引号:

```
number=1

if [ $number = 1 ]; then
    echo "Number is euqal to 1.
else
    echo "Number is not euqal to 1."
fi
```

运行脚本, 出现的现象如下:

```
./test.sh: 行 269: 寻找匹配的 `"' 是遇到了未预期的文件结束符
./test.sh: 行 272: 语法错误: 未预期的文件结尾
```

脚本产生了两个错误, 错误报告指出的行不是删除所在的行, 而是之后的代码. 这是因为shell读取到删除双引号的位置之后, 继续向下寻找对应的双引号, 直到第二个echo命令的双引号处, 导致if命令的语法结构被破坏.

使用带语法结构突出显示的编辑器能够帮助寻找这类错误, 如果是vim可以使用以下命令启动vim的语法结构突出显示功能:

```
:syntax on
```

### 30.1.2 符号缺失冗余 ###

### 30.1.3 非预期的展开 ###

## 30.2 逻辑错误 ##

### 30.2.1 防御编程 ###

### 30.2.2 输入值验证 ###

## 30.3 测试 ##

### 30.3.1 桩 ###

### 30.3.2 测试用例 ###

## 30.4 调试 ##

### 30.4.1 找到问题域 ###

### 30.4.2 追踪 ###

### 30.4.3 运行过程中变量的检验 ###

## 30.5 本章结尾语 ##
