# 第二十二章: 打印 #

本章介绍的命令如下:

- pr: 转换文本文件, 从而进行打印操作
- lpr: 打印文件
- lp: 打印文件(System V)
- a2ps: 格式化文件, 以在PostScript打印机上打印
- lpstat: 显示打印状态信息
- lpq: 显示打印机队列状态
- lprm: 取消打印任务
- cancel: 取消打印任务(System V)

## 22.1 打印操作简史 ##

### 22.1.1 灰暗时期的打印 ###

UNIX早期, 打印机贵而集中化, 多个用户共用一台打印机是司空见惯的事.

### 22.1.2 基于字符的打印机 ###

需要打印的字符数据以简单的字节流形式发送给类打印机打印设备, 低编号的ASCII控制码则用于移动打印机的送纸箱和纸张, 以及取代回车, 换行和换页符等.

### 22.1.3 图形化打印机 ###

页面描述语言是一种描述页面内容的编程语言, 第一个主流页面描述语言是Adobe系统的PostScript, 至今仍被广泛使用.

## 22.2 Linux方式的打印 ##

现代Linux系统采取两组软件来执行和管理打印操作: 第一种是CUPS(通用UNIX打印系统), 提供打印驱动程序以及打印任务管理程序; 另一种是GhostScript, 这是一个PostScrit编译器.

## 22.3 准备打印文件 ##

### 22.3.1 pr-将文本文件转换为打印文件 ###

基于字符的打印机使用等宽字体使得每页有固定数目的行并且每行有固定的字符数, pr则用于调整文本以适应特定纸张的大小, 并且可自主选择页眉和页边距.
常见的pr选项如下:

| 选项 | 功能描述 |
|:--|:--|
| +first[:last] | 输出一个从first开始以last结束的页范围 |
| -columns | 将页的内容分成指定的columns列 |
| -a | 默认情况下, 多列输出是垂直列出的, 通过这个选项使内容水平列出 |
| -d | 隔行打印输出 |
| -D format | 用format格式来格式化页眉的显示日期, 可以查看日期命令的man手册页以了解格式字符串的描述 |
| -f | 使用换页符而不是回车符作为页与页之间的分隔符 |
| -h header | 在页眉的中间部分, 使用header代替正在处理的文件名 |
| -l length | 将页的长度设为length, 默认为66行 |
| -n | 对行进行编号 |
| -o offset | 创建一个有offset字符宽的左页边距 |
| -w width | 设定页面宽度为width, 默认为72个字符 |

以下的代码输出 /usr/bin 目录下的内容列表, 并用pr将其格式化为分页的三列的输出:

```
ls /usr/bin | pr -3 -w 65 | head
```

## 22.4 向打印机发送打印任务 ##

CUPS打印组件支持两种打印方法: 一种方法是Berkeley或LPD, 使用lpr命令; 另外一种是SysV, 使用lp命令.

### 22.4.1 lpr-打印文件(Berkeley类型) ###

lpr命令可以将文件送至打印机, 同时由于其支持标准输入, 所以也可用于管道传输.

```
ls /usr/bin | pr -3 | lpr
```

该命令将报告送至系统默认的打印机, 如果想要将文件发送至不同的打印机, 可以使用 -P 选项:

```
lpr -P printer_name
```

此处的printer_name 是指目标打印机的名称, 可以用下面的命令行查看系统打印机列表:

```
lpstat -a
```

许多Linux发行版可以定义一个虚拟打印机, 以输出PDF格式的文件, 而不是真正的物理打印机上打印. 对于某些发行版本, 可能会需要安装额外的软件包(例如cups-pdf) 以支持这一特性.

lpr常用的选项如下表:

| 选项 | 功能描述 |
|:--|:--|
| -# number | 打印number份副本 |
| -p | 每一页都将包括日期, 时间, 工作名称和页码的页眉用阴影打印出来 |
| -P printer | 指定用于输出的打印机名称, 如果未指定则使用系统默认的打印机 |
| -r | 打印结束后删除文件, 适用于那些产生临时打印输出文件的程序 |

### 22.4.2 lp-打印文件(System V类型) ###

### 22.4.3 另外一个参数选项: a2ps ###

## 22.5 监测和控制打印任务 ##

### 22.5.1 lpstat-显示打印系统状态 ###

### 22.5.2 lpq-显示打印队列状态 ###

### 22.5.3 lprm与cancel-删除打印任务 ###
