docker使用

1：拉取基础镜像
docker pull ubuntu:14.04

(删除使用 docker rmi)

sudo docker rmi -f $(docker images -q redis)

2: 启动容器

docker run -it --rm ubuntu:14.04 /bin/bash

3: 更换阿里云源

cd /etc/apt
mv source.list source.list.bak
vi source.list

写入:
deb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse

apt-get update
apt-get install vim python uwsgi python-pip uwsgi-plugin-python

pip install flask

4: 配置uwsgi

[uwsgi]
plugins = python
# vhost = true
socket = 0.0.0.0:8084
protocol = http
chdir = /data/www
wsgi-file = app.py
# module = app
callable = app
processes = 4
pidfile = /tmp/uwsgi.pid
daemonize = /data/www/app.log
vacuum = true
# disable-logging = true
log-maxsize = 5000000
master-as-root = true


启动:
uwsgi xxx.ini

uwsgi --stop xxx.pid


5: 配置supervisor

apt-get install supervisor

cd /etc/supervisor/conf.d

echo_supervisord_config > app.conf
vim app.conf

[program:app]
command = /usr/bin/uwsgi --ini /etc/uwsgi/apps-enabled/app.ini
stopsignal=QUIT
autostart=true
autorestart=true
stdout_logfile=/var/log/uwsgi/supervisor_chihu.log
stderr_logfile=/var/log/uwsgi/supervisor_chihu_err.log
stdout_logfile=/dev/stdout

supervisord -c app.conf

注意: 需要取消掉uwsgi.conf中的daemonize

docker build -t python:v2.7.12 .

--no-install-recommends

